<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>ApplicationUtils.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">psi-probe-core</a> &gt; <a href="index.source.html" class="el_package">psiprobe.tools</a> &gt; <span class="el_source">ApplicationUtils.java</span></div><h1>ApplicationUtils.java</h1><pre class="source lang-java linenums">/**
 * Licensed under the GPL License. You may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   https://www.gnu.org/licenses/old-licenses/gpl-2.0.html
 *
 * THIS PACKAGE IS PROVIDED &quot;AS IS&quot; AND WITHOUT ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING,
 * WITHOUT LIMITATION, THE IMPLIED WARRANTIES OF MERCHANTIBILITY AND FITNESS FOR A PARTICULAR
 * PURPOSE.
 */
package psiprobe.tools;

import java.io.Serializable;
import java.lang.reflect.InvocationTargetException;
import java.util.ArrayList;
import java.util.Arrays;
import java.util.Collections;
import java.util.Date;
import java.util.HashSet;
import java.util.List;
import java.util.Locale;
import java.util.Set;
import javax.naming.NamingException;
import javax.servlet.ServletContext;
import javax.servlet.http.HttpSession;
import org.apache.catalina.Container;
import org.apache.catalina.Context;
import org.apache.catalina.Session;
import org.apache.catalina.Wrapper;
import org.apache.catalina.core.StandardWrapper;
import org.apache.commons.lang3.reflect.MethodUtils;
import org.slf4j.Logger;
import org.slf4j.LoggerFactory;
import org.springframework.util.ClassUtils;
import psiprobe.beans.ContainerWrapperBean;
import psiprobe.beans.ResourceResolver;
import psiprobe.model.Application;
import psiprobe.model.ApplicationParam;
import psiprobe.model.ApplicationResource;
import psiprobe.model.ApplicationSession;
import psiprobe.model.Attribute;
import psiprobe.model.FilterInfo;
import psiprobe.model.ServletInfo;
import psiprobe.model.ServletMapping;

/**
 * The Class ApplicationUtils.
 */
public final class ApplicationUtils {

  /** The Constant logger. */
<span class="nc" id="L52">  private static final Logger logger = LoggerFactory.getLogger(ApplicationUtils.class);</span>

  /**
   * Prevent Instantiation.
   */
  private ApplicationUtils() {
    // Prevent Instantiation
  }

  /**
   * Gets the application.
   *
   * @param context the context
   * @param containerWrapper the container wrapper
   * @return the application
   */
  public static Application getApplication(Context context, ContainerWrapperBean containerWrapper) {
<span class="nc" id="L69">    return getApplication(context, null, false, containerWrapper);</span>
  }

  /**
   * Creates Application instance from Tomcat Context object. If ResourceResolver is passed the
   * method will also collect additional information about the application such as session count,
   * session attribute count, application attribute count, servlet count, servlet stats summary and
   * datasource usage summary. Collecting additional information can be CPU intensive and time
   * consuming so this should be avoided unless absolutely required. Some datasource implementations
   * (c3p0) are known to be prone to internal deadlocks, so this method can also hang is datasource
   * usage stats is to be collected.
   *
   * @param context the context from which to create the Application
   * @param resourceResolver the resolver to use for resources associated with the given context
   * @param calcSize flag which controls whether to calculate session size
   * @param containerWrapper the wrapper for the context's root containing server
   * @return Application object
   */
  public static Application getApplication(Context context, ResourceResolver resourceResolver,
      boolean calcSize, ContainerWrapperBean containerWrapper) {

    // ContainerWrapperBean containerWrapper
<span class="nc" id="L91">    logger.debug(&quot;Querying webapp: {}&quot;, context.getName());</span>

<span class="nc" id="L93">    Application app = new Application();</span>
<span class="nc bnc" id="L94" title="All 2 branches missed.">    app.setName(context.getName().length() &gt; 0 ? context.getName() : &quot;/&quot;);</span>
<span class="nc" id="L95">    app.setDocBase(context.getDocBase());</span>
<span class="nc" id="L96">    app.setDisplayName(context.getDisplayName());</span>

<span class="nc" id="L98">    app.setAvailable(containerWrapper.getTomcatContainer().getAvailable(context));</span>
<span class="nc" id="L99">    app.setDistributable(context.getDistributable());</span>
<span class="nc" id="L100">    app.setSessionTimeout(context.getSessionTimeout());</span>
<span class="nc" id="L101">    app.setServletVersion(context.getServletContext().getMajorVersion() + &quot;.&quot;</span>
<span class="nc" id="L102">        + context.getServletContext().getMinorVersion());</span>

<span class="nc bnc" id="L104" title="All 2 branches missed.">    if (resourceResolver != null) {</span>
<span class="nc" id="L105">      logger.debug(&quot;counting servlet attributes&quot;);</span>

<span class="nc" id="L107">      app.setContextAttributeCount(</span>
<span class="nc" id="L108">          Collections.list(context.getServletContext().getAttributeNames()).size());</span>

<span class="nc bnc" id="L110" title="All 2 branches missed.">      if (app.isAvailable()) {</span>
<span class="nc" id="L111">        logger.debug(&quot;collecting session information&quot;);</span>

<span class="nc" id="L113">        app.setSessionCount(context.getManager().findSessions().length);</span>

<span class="nc" id="L115">        boolean serializable = true;</span>
<span class="nc" id="L116">        int sessionAttributeCount = 0;</span>
<span class="nc" id="L117">        long size = 0;</span>

<span class="nc bnc" id="L119" title="All 2 branches missed.">        for (Session session : context.getManager().findSessions()) {</span>
<span class="nc" id="L120">          ApplicationSession appSession = getApplicationSession(session, calcSize, false);</span>
<span class="nc bnc" id="L121" title="All 2 branches missed.">          if (appSession != null) {</span>
<span class="nc" id="L122">            sessionAttributeCount += appSession.getObjectCount();</span>
<span class="nc bnc" id="L123" title="All 4 branches missed.">            serializable = serializable &amp;&amp; appSession.isSerializable();</span>
<span class="nc" id="L124">            size += appSession.getSize();</span>
          }
        }
<span class="nc" id="L127">        app.setSerializable(serializable);</span>
<span class="nc" id="L128">        app.setSessionAttributeCount(sessionAttributeCount);</span>
<span class="nc" id="L129">        app.setSize(size);</span>
      }

<span class="nc" id="L132">      logger.debug(&quot;aggregating servlet stats&quot;);</span>

<span class="nc" id="L134">      collectApplicationServletStats(context, app);</span>

<span class="nc bnc" id="L136" title="All 4 branches missed.">      if (resourceResolver.supportsPrivateResources() &amp;&amp; app.isAvailable()) {</span>
<span class="nc" id="L137">        int[] scores =</span>
<span class="nc" id="L138">            getApplicationDataSourceUsageScores(context, resourceResolver, containerWrapper);</span>
<span class="nc" id="L139">        app.setDataSourceBusyScore(scores[0]);</span>
<span class="nc" id="L140">        app.setDataSourceEstablishedScore(scores[1]);</span>
      }
    }

<span class="nc" id="L144">    return app;</span>
  }

  /**
   * Calculates Sum of requestCount, errorCount and processingTime for all servlets for the given
   * application. It also works out minimum value of minTime and maximum value for maxTime for all
   * servlets.
   *
   * @param context the context whose stats will be collected
   * @param app the application in which to store the collected stats
   */
  public static void collectApplicationServletStats(Context context, Application app) {
<span class="nc" id="L156">    int svltCount = 0;</span>
<span class="nc" id="L157">    int reqCount = 0;</span>
<span class="nc" id="L158">    int errCount = 0;</span>
<span class="nc" id="L159">    long procTime = 0;</span>
<span class="nc" id="L160">    long minTime = Long.MAX_VALUE;</span>
<span class="nc" id="L161">    long maxTime = 0;</span>

<span class="nc bnc" id="L163" title="All 2 branches missed.">    for (Container container : context.findChildren()) {</span>
<span class="nc bnc" id="L164" title="All 2 branches missed.">      if (container instanceof StandardWrapper) {</span>
<span class="nc" id="L165">        StandardWrapper sw = (StandardWrapper) container;</span>
<span class="nc" id="L166">        svltCount++;</span>
<span class="nc" id="L167">        reqCount += sw.getRequestCount();</span>
<span class="nc" id="L168">        errCount += sw.getErrorCount();</span>
<span class="nc" id="L169">        procTime += sw.getProcessingTime();</span>
<span class="nc bnc" id="L170" title="All 2 branches missed.">        if (sw.getRequestCount() &gt; 0) {</span>
<span class="nc" id="L171">          minTime = Math.min(minTime, sw.getMinTime());</span>
        }
<span class="nc" id="L173">        maxTime = Math.max(maxTime, sw.getMaxTime());</span>
      }
    }
<span class="nc" id="L176">    app.setServletCount(svltCount);</span>
<span class="nc" id="L177">    app.setRequestCount(reqCount);</span>
<span class="nc" id="L178">    app.setErrorCount(errCount);</span>
<span class="nc" id="L179">    app.setProcessingTime(procTime);</span>
<span class="nc bnc" id="L180" title="All 2 branches missed.">    app.setMinTime(minTime == Long.MAX_VALUE ? 0 : minTime);</span>
<span class="nc" id="L181">    app.setMaxTime(maxTime);</span>
<span class="nc" id="L182">  }</span>

  /**
   * Gets the application data source usage scores.
   *
   * @param context the context
   * @param resolver the resolver
   * @param containerWrapper the container wrapper
   * @return the application data source usage scores
   */
  public static int[] getApplicationDataSourceUsageScores(Context context,
      ResourceResolver resolver, ContainerWrapperBean containerWrapper) {

<span class="nc" id="L195">    logger.debug(&quot;Calculating datasource usage score&quot;);</span>

<span class="nc" id="L197">    int[] scores = new int[] {0, 0};</span>
    List&lt;ApplicationResource&gt; appResources;
    try {
<span class="nc" id="L200">      appResources = resolver.getApplicationResources(context, containerWrapper);</span>
<span class="nc" id="L201">    } catch (NamingException e) {</span>
<span class="nc" id="L202">      throw new RuntimeException(e);</span>
<span class="nc" id="L203">    }</span>
<span class="nc bnc" id="L204" title="All 2 branches missed.">    for (ApplicationResource appResource : appResources) {</span>
<span class="nc bnc" id="L205" title="All 2 branches missed.">      if (appResource.getDataSourceInfo() != null) {</span>
<span class="nc" id="L206">        scores[0] = Math.max(scores[0], appResource.getDataSourceInfo().getBusyScore());</span>
<span class="nc" id="L207">        scores[1] = Math.max(scores[1], appResource.getDataSourceInfo().getEstablishedScore());</span>
      }
<span class="nc" id="L209">    }</span>
<span class="nc" id="L210">    return scores;</span>
  }

  /**
   * Gets the application session.
   *
   * @param session the session
   * @param calcSize the calc size
   * @param addAttributes the add attributes
   * @return the application session
   */
  public static ApplicationSession getApplicationSession(Session session, boolean calcSize,
      boolean addAttributes) {

<span class="nc" id="L224">    ApplicationSession sbean = null;</span>
<span class="nc bnc" id="L225" title="All 4 branches missed.">    if (session != null &amp;&amp; session.isValid()) {</span>
<span class="nc" id="L226">      sbean = new ApplicationSession();</span>

<span class="nc" id="L228">      sbean.setId(session.getId());</span>
<span class="nc" id="L229">      sbean.setCreationTime(new Date(session.getCreationTime()));</span>
<span class="nc" id="L230">      sbean.setLastAccessTime(new Date(session.getLastAccessedTime()));</span>
<span class="nc" id="L231">      sbean.setMaxIdleTime(session.getMaxInactiveInterval() * 1000);</span>
<span class="nc" id="L232">      sbean.setManagerType(session.getManager().getClass().getName());</span>

      // Tomcat 8+ dropped support of getInfo off session. This patch allows it to continue working
      // for tomcat 7.
      try {
<span class="nc" id="L237">        Object info = MethodUtils.invokeMethod(session, &quot;getInfo&quot;);</span>
<span class="nc" id="L238">        sbean.setInfo(String.valueOf(info));</span>
<span class="nc" id="L239">      } catch (NoSuchMethodException | IllegalAccessException | InvocationTargetException e) {</span>
<span class="nc" id="L240">        sbean.setInfo(session.getClass().getSimpleName());</span>
<span class="nc" id="L241">        logger.trace(&quot;Cannot determine session info for tomcat 8+&quot;, e);</span>
<span class="nc" id="L242">      }</span>

<span class="nc" id="L244">      boolean sessionSerializable = true;</span>
<span class="nc" id="L245">      int attributeCount = 0;</span>
<span class="nc" id="L246">      long size = 0;</span>

<span class="nc" id="L248">      HttpSession httpSession = session.getSession();</span>
<span class="nc" id="L249">      Set&lt;Object&gt; processedObjects = new HashSet&lt;&gt;(1000);</span>

      // Exclude references back to the session itself
<span class="nc" id="L252">      processedObjects.add(httpSession);</span>
      try {
<span class="nc bnc" id="L254" title="All 2 branches missed.">        for (String name : Collections.list(httpSession.getAttributeNames())) {</span>
<span class="nc" id="L255">          Object obj = httpSession.getAttribute(name);</span>
<span class="nc bnc" id="L256" title="All 4 branches missed.">          sessionSerializable = sessionSerializable &amp;&amp; obj instanceof Serializable;</span>

<span class="nc" id="L258">          long objSize = 0;</span>
<span class="nc bnc" id="L259" title="All 2 branches missed.">          if (calcSize) {</span>
            try {
<span class="nc" id="L261">              objSize += Instruments.sizeOf(name, processedObjects);</span>
<span class="nc" id="L262">              objSize += Instruments.sizeOf(obj, processedObjects);</span>
<span class="nc" id="L263">            } catch (Exception ex) {</span>
<span class="nc" id="L264">              logger.error(&quot;Cannot estimate size of attribute '{}'&quot;, name, ex);</span>
<span class="nc" id="L265">            }</span>
          }

<span class="nc bnc" id="L268" title="All 2 branches missed.">          if (addAttributes) {</span>
<span class="nc" id="L269">            Attribute saBean = new Attribute();</span>
<span class="nc" id="L270">            saBean.setName(name);</span>
<span class="nc" id="L271">            saBean.setType(ClassUtils.getQualifiedName(obj.getClass()));</span>
<span class="nc" id="L272">            saBean.setValue(obj);</span>
<span class="nc" id="L273">            saBean.setSize(objSize);</span>
<span class="nc" id="L274">            saBean.setSerializable(obj instanceof Serializable);</span>
<span class="nc" id="L275">            sbean.addAttribute(saBean);</span>
          }
<span class="nc" id="L277">          attributeCount++;</span>
<span class="nc" id="L278">          size += objSize;</span>
<span class="nc" id="L279">        }</span>
<span class="nc" id="L280">        String lastAccessedIp =</span>
<span class="nc" id="L281">            (String) httpSession.getAttribute(ApplicationSession.LAST_ACCESSED_BY_IP);</span>
<span class="nc bnc" id="L282" title="All 2 branches missed.">        if (lastAccessedIp != null) {</span>
<span class="nc" id="L283">          sbean.setLastAccessedIp(lastAccessedIp);</span>
<span class="nc" id="L284">          sbean.setLastAccessedIpLocale(</span>
<span class="nc" id="L285">              (Locale) httpSession.getAttribute(ApplicationSession.LAST_ACCESSED_LOCALE));</span>
        }

<span class="nc" id="L288">      } catch (IllegalStateException e) {</span>
<span class="nc" id="L289">        logger.info(&quot;Session appears to be invalidated, ignore&quot;);</span>
<span class="nc" id="L290">        logger.trace(&quot;&quot;, e);</span>
<span class="nc" id="L291">      }</span>

<span class="nc" id="L293">      sbean.setObjectCount(attributeCount);</span>
<span class="nc" id="L294">      sbean.setSize(size);</span>
<span class="nc" id="L295">      sbean.setSerializable(sessionSerializable);</span>
    }

<span class="nc" id="L298">    return sbean;</span>
  }

  /**
   * Gets the application attributes.
   *
   * @param context the context
   * @return the application attributes
   */
  public static List&lt;Attribute&gt; getApplicationAttributes(Context context) {
<span class="nc" id="L308">    List&lt;Attribute&gt; attrs = new ArrayList&lt;&gt;();</span>
<span class="nc" id="L309">    ServletContext servletCtx = context.getServletContext();</span>
<span class="nc bnc" id="L310" title="All 2 branches missed.">    for (String attrName : Collections.list(servletCtx.getAttributeNames())) {</span>
<span class="nc" id="L311">      Object attrValue = servletCtx.getAttribute(attrName);</span>

<span class="nc" id="L313">      Attribute attr = new Attribute();</span>
<span class="nc" id="L314">      attr.setName(attrName);</span>
<span class="nc" id="L315">      attr.setValue(attrValue);</span>
<span class="nc" id="L316">      attr.setType(ClassUtils.getQualifiedName(attrValue.getClass()));</span>
<span class="nc" id="L317">      attrs.add(attr);</span>
<span class="nc" id="L318">    }</span>
<span class="nc" id="L319">    return attrs;</span>
  }

  /**
   * Gets the application init params.
   *
   * @param context the context
   * @param containerWrapper the container wrapper
   * @return the application init params
   */
  public static List&lt;ApplicationParam&gt; getApplicationInitParams(Context context,
      ContainerWrapperBean containerWrapper) {

<span class="nc" id="L332">    return containerWrapper.getTomcatContainer().getApplicationInitParams(context);</span>
  }

  /**
   * Gets the application servlet.
   *
   * @param context the context
   * @param servletName the servlet name
   * @return the application servlet
   */
  public static ServletInfo getApplicationServlet(Context context, String servletName) {
<span class="nc" id="L343">    Container container = context.findChild(servletName);</span>

<span class="nc bnc" id="L345" title="All 2 branches missed.">    if (container instanceof Wrapper) {</span>
<span class="nc" id="L346">      Wrapper wrapper = (Wrapper) container;</span>
<span class="nc" id="L347">      return getServletInfo(wrapper, context.getName());</span>
    }
<span class="nc" id="L349">    return null;</span>
  }

  /**
   * Gets the servlet info.
   *
   * @param wrapper the wrapper
   * @param contextName the context name
   * @return the servlet info
   */
  private static ServletInfo getServletInfo(Wrapper wrapper, String contextName) {
<span class="nc" id="L360">    ServletInfo si = new ServletInfo();</span>
<span class="nc bnc" id="L361" title="All 2 branches missed.">    si.setApplicationName(contextName.length() &gt; 0 ? contextName : &quot;/&quot;);</span>
<span class="nc" id="L362">    si.setServletName(wrapper.getName());</span>
<span class="nc" id="L363">    si.setServletClass(wrapper.getServletClass());</span>
<span class="nc bnc" id="L364" title="All 2 branches missed.">    si.setAvailable(!wrapper.isUnavailable());</span>
<span class="nc" id="L365">    si.setLoadOnStartup(wrapper.getLoadOnStartup());</span>
<span class="nc" id="L366">    si.setRunAs(wrapper.getRunAs());</span>
<span class="nc" id="L367">    si.getMappings().addAll(Arrays.asList(wrapper.findMappings()));</span>
<span class="nc bnc" id="L368" title="All 2 branches missed.">    if (wrapper instanceof StandardWrapper) {</span>
<span class="nc" id="L369">      StandardWrapper sw = (StandardWrapper) wrapper;</span>
<span class="nc" id="L370">      si.setAllocationCount(sw.getCountAllocated());</span>
<span class="nc" id="L371">      si.setErrorCount(sw.getErrorCount());</span>
<span class="nc" id="L372">      si.setLoadTime(sw.getLoadTime());</span>
<span class="nc" id="L373">      si.setMaxInstances(sw.getMaxInstances());</span>
<span class="nc" id="L374">      si.setMaxTime(sw.getMaxTime());</span>
<span class="nc bnc" id="L375" title="All 2 branches missed.">      si.setMinTime(sw.getMinTime() == Long.MAX_VALUE ? 0 : sw.getMinTime());</span>
<span class="nc" id="L376">      si.setProcessingTime(sw.getProcessingTime());</span>
<span class="nc" id="L377">      si.setRequestCount(sw.getRequestCount());</span>
      // Tomcat 7.0.72+, 8.0.37+, 8.5.5+, and 9.0.0.M10 modified from boolean to Boolean.
      // Since SingleThreadModel deprecated in servlet 2.4 with no direct replacement,
      // we will continue to handle as boolean. Previously calling this would have
      // resulted in class being loaded if not already. This is why Null is returned
      // now.
      try {
<span class="nc" id="L384">        Object singleThreaded = MethodUtils.invokeMethod(sw, &quot;isSingleThreadModel&quot;);</span>
<span class="nc bnc" id="L385" title="All 2 branches missed.">        if (singleThreaded == null) {</span>
<span class="nc" id="L386">          si.setSingleThreaded(false);</span>
        } else {
<span class="nc" id="L388">          si.setSingleThreaded(Boolean.parseBoolean(String.valueOf(singleThreaded)));</span>
        }
<span class="nc" id="L390">      } catch (NoSuchMethodException | IllegalAccessException | InvocationTargetException e) {</span>
<span class="nc" id="L391">        logger.error(&quot;Cannot determine single threading&quot;);</span>
<span class="nc" id="L392">        logger.trace(&quot;&quot;, e);</span>
<span class="nc" id="L393">      }</span>
    }
<span class="nc" id="L395">    return si;</span>
  }

  /**
   * Gets the application servlets.
   *
   * @param context the context
   * @return the application servlets
   */
  public static List&lt;ServletInfo&gt; getApplicationServlets(Context context) {
<span class="nc" id="L405">    Container[] cns = context.findChildren();</span>
<span class="nc" id="L406">    List&lt;ServletInfo&gt; servlets = new ArrayList&lt;&gt;(cns.length);</span>
<span class="nc bnc" id="L407" title="All 2 branches missed.">    for (Container container : cns) {</span>
<span class="nc bnc" id="L408" title="All 2 branches missed.">      if (container instanceof Wrapper) {</span>
<span class="nc" id="L409">        Wrapper wrapper = (Wrapper) container;</span>
<span class="nc" id="L410">        servlets.add(getServletInfo(wrapper, context.getName()));</span>
      }
    }
<span class="nc" id="L413">    return servlets;</span>
  }

  /**
   * Gets the application servlet maps.
   *
   * @param context the context
   * @return the application servlet maps
   */
  public static List&lt;ServletMapping&gt; getApplicationServletMaps(Context context) {
<span class="nc" id="L423">    String[] sms = context.findServletMappings();</span>
<span class="nc" id="L424">    List&lt;ServletMapping&gt; servletMaps = new ArrayList&lt;&gt;(sms.length);</span>
<span class="nc bnc" id="L425" title="All 2 branches missed.">    for (String servletMapping : sms) {</span>
<span class="nc bnc" id="L426" title="All 2 branches missed.">      if (servletMapping != null) {</span>
<span class="nc" id="L427">        String sn = context.findServletMapping(servletMapping);</span>
<span class="nc bnc" id="L428" title="All 2 branches missed.">        if (sn != null) {</span>
<span class="nc" id="L429">          ServletMapping sm = new ServletMapping();</span>
<span class="nc bnc" id="L430" title="All 2 branches missed.">          sm.setApplicationName(context.getName().length() &gt; 0 ? context.getName() : &quot;/&quot;);</span>
<span class="nc" id="L431">          sm.setUrl(servletMapping);</span>
<span class="nc" id="L432">          sm.setServletName(sn);</span>
<span class="nc" id="L433">          Container container = context.findChild(sn);</span>
<span class="nc bnc" id="L434" title="All 2 branches missed.">          if (container instanceof Wrapper) {</span>
<span class="nc" id="L435">            Wrapper wrapper = (Wrapper) container;</span>
<span class="nc" id="L436">            sm.setServletClass(wrapper.getServletClass());</span>
<span class="nc bnc" id="L437" title="All 2 branches missed.">            sm.setAvailable(!wrapper.isUnavailable());</span>
          }
<span class="nc" id="L439">          servletMaps.add(sm);</span>
        }
      }
    }
<span class="nc" id="L443">    return servletMaps;</span>
  }

  /**
   * Gets the application filters.
   *
   * @param context the context
   * @param containerWrapper the container wrapper
   * @return the application filters
   */
  public static List&lt;FilterInfo&gt; getApplicationFilters(Context context,
      ContainerWrapperBean containerWrapper) {
<span class="nc" id="L455">    return containerWrapper.getTomcatContainer().getApplicationFilters(context);</span>
  }

}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.2.201808211720</span></div></body></html>